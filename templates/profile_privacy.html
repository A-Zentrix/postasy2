{% extends "base.html" %}

{% block title %}Privacy Settings - Postasy{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <!-- Settings Sidebar -->
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title">Settings</h6>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('profile.manage') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-user me-2"></i>Profile
                        </a>
                        <a href="{{ url_for('profile.settings') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                        <a href="{{ url_for('profile.privacy') }}" class="list-group-item list-group-item-action active">
                            <i class="fas fa-shield-alt me-2"></i>Privacy
                        </a>
                        <a href="{{ url_for('payment.plans') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-crown me-2"></i>Subscription
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-9">
            <!-- Privacy Settings -->
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h4 class="card-title mb-4">
                        <i class="fas fa-shield-alt me-2"></i>Privacy & Security
                    </h4>
                    
                    <!-- Profile Privacy -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Profile Privacy</h6>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card bg-light border-0 mb-3">
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="profileVisibility" checked>
                                            <label class="form-check-label" for="profileVisibility">
                                                <strong>Public Profile</strong>
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            When enabled, your profile can be viewed by anyone. 
                                            Your basic information and public posters will be visible.
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="card bg-light border-0 mb-3">
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="showActivity">
                                            <label class="form-check-label" for="showActivity">
                                                <strong>Show Activity</strong>
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            Display your recent poster creation activity on your profile.
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="showContactInfo" checked>
                                            <label class="form-check-label" for="showContactInfo">
                                                <strong>Show Contact Information</strong>
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            Display your business contact information on your public profile.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Poster Privacy -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Poster Privacy</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <h6 class="card-title">Default Visibility</h6>
                                        <select class="form-select mb-2" id="defaultPosterVisibility">
                                            <option value="private" selected>Private (Only you can see)</option>
                                            <option value="public">Public (Anyone can see)</option>
                                        </select>
                                        <small class="text-muted">
                                            New posters will use this privacy setting by default.
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <h6 class="card-title">Download Protection</h6>
                                        <div class="form-check form-switch mb-2">
                                            <input class="form-check-input" type="checkbox" id="preventDownload">
                                            <label class="form-check-label" for="preventDownload">
                                                Disable Right-Click Save
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            Add basic protection against casual downloading.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Privacy -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Data Privacy</h6>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card bg-light border-0 mb-3">
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="analyticsOptOut">
                                            <label class="form-check-label" for="analyticsOptOut">
                                                <strong>Opt out of Analytics</strong>
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            Prevent collection of usage analytics and metrics.
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="card bg-light border-0 mb-3">
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="aiTrainingOptOut">
                                            <label class="form-check-label" for="aiTrainingOptOut">
                                                <strong>Opt out of AI Training</strong>
                                            </label>
                                        </div>
                                        <small class="text-muted">
                                            Prevent your prompts and posters from being used to improve our AI models.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Settings -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Security</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <h6 class="card-title">Password</h6>
                                        <p class="card-text small text-muted">
                                            Last changed: {{ current_user.updated_at.strftime('%B %d, %Y') }}
                                        </p>
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                                            <i class="fas fa-key me-1"></i>Change Password
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light border-0">
                                    <div class="card-body">
                                        <h6 class="card-title">Active Sessions</h6>
                                        <p class="card-text small text-muted">
                                            Currently signed in on 1 device
                                        </p>
                                        <button class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-sign-out-alt me-1"></i>Sign Out All Devices
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Download -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Your Data</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border-info">
                                    <div class="card-body">
                                        <h6 class="card-title text-info">
                                            <i class="fas fa-download me-2"></i>Download Your Data
                                        </h6>
                                        <p class="card-text small">
                                            Get a copy of all your data including profile, posters, and settings.
                                        </p>
                                        <button class="btn btn-info btn-sm">
                                            <i class="fas fa-download me-1"></i>Request Download
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-warning">
                                    <div class="card-body">
                                        <h6 class="card-title text-warning">
                                            <i class="fas fa-trash me-2"></i>Delete All Data
                                        </h6>
                                        <p class="card-text small">
                                            Permanently delete your account and all associated data.
                                        </p>
                                        <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#deleteDataModal">
                                            <i class="fas fa-trash me-1"></i>Delete Everything
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-primary" id="savePrivacySettings">
                            <i class="fas fa-save me-1"></i>Save Privacy Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-key me-2"></i>Change Password
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" required>
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="newPassword" required>
                        <div class="form-text">Must be at least 8 characters long</div>
                    </div>
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="updatePassword">
                    <i class="fas fa-save me-1"></i>Update Password
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Data Modal -->
<div class="modal fade" id="deleteDataModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>Delete All Data
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <strong>Warning:</strong> This action cannot be undone!
                </div>
                <p>This will permanently delete:</p>
                <ul>
                    <li>Your profile and account information</li>
                    <li>All posters (public and private)</li>
                    <li>Your subscription and billing history</li>
                    <li>All settings and preferences</li>
                </ul>
                <p>Type <strong>DELETE ALL DATA</strong> to confirm:</p>
                <input type="text" class="form-control" id="deleteDataConfirmation" placeholder="Type DELETE ALL DATA">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteData" disabled>
                    <i class="fas fa-trash me-1"></i>Delete All Data
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Save privacy settings
document.getElementById('savePrivacySettings').addEventListener('click', function() {
    const btn = this;
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Saving...';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-check me-1"></i>Saved!';
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 1500);
    }, 1000);
});

// Change password validation
document.getElementById('updatePassword').addEventListener('click', function() {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    if (newPassword !== confirmPassword) {
        alert('Passwords do not match!');
        return;
    }
    
    if (newPassword.length < 8) {
        alert('Password must be at least 8 characters long!');
        return;
    }
    
    // Simulate password update
    alert('Password updated successfully!');
    bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
});

// Delete data confirmation
document.getElementById('deleteDataConfirmation').addEventListener('input', function() {
    const confirmBtn = document.getElementById('confirmDeleteData');
    confirmBtn.disabled = this.value !== 'DELETE ALL DATA';
});

document.getElementById('confirmDeleteData').addEventListener('click', function() {
    alert('Data deletion would be processed here in a real implementation.');
});

// Auto-save on privacy toggle changes
document.querySelectorAll('.form-check-input').forEach(toggle => {
    toggle.addEventListener('change', function() {
        // Show subtle feedback
        const label = this.nextElementSibling;
        const originalColor = label.style.color;
        label.style.color = '#28a745';
        
        setTimeout(() => {
            label.style.color = originalColor;
        }, 1000);
    });
});
</script>
{% endblock %}